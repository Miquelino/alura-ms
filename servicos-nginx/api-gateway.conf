server {
    listen 80;

    # DNS interno do Docker
    resolver 127.0.0.11 valid=30s;

    # Configurações comuns de Proxy
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # --- Rota Financeiro (PHP) ---
    location /financeiro/ {
        set $target_financeiro http://web-financeiro:9501;
        # Remove "/financeiro" da URL antes de enviar ao PHP
        rewrite ^/financeiro/(.*) /$1 break;
        proxy_pass $target_financeiro;
    }

    # --- Rota Marketing (Node.js) ---
    location /mkt/ {
        set $target_mkt http://web-mkt:3000;
        # Remove "/mkt" da URL antes de enviar ao Node
        rewrite ^/mkt/(.*) /$1 break;
        proxy_pass $target_mkt;
    }

    # --- Rota Acadêmico (PHP) ---
    location /academico/ {
        set $target_academico http://web-academico:8080;
        # Remove "/academico" da URL antes de enviar ao PHP
        rewrite ^/academico/(.*) /$1 break;
        proxy_pass $target_academico;
    }

    # Página de erro amigável se o backend estiver fora
    error_page 502 /502.html;
    location = /502.html {
        return 502 "Serviço temporariamente indisponível. Aguarde o boot dos containers...";
    }
}